<html>
    <head>
        <title>OneMap2 XYZ (Default)</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
        <!-- onemap's leaflet is 0.7.7 -->
        <!-- script src="https://cdn.onemap.sg/leaflet/onemap-leaflet.js"></script -->
        <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
        <script src="https://unpkg.com/togeojson@0.16.0"></script>
        <script src="https://unpkg.com/leaflet-filelayer@1.2.0"></script>
    </head>
    <body>
    <h1>Singapore Map</h1>
    <div id='mapdiv' style='height:800px;'></div>
</body>
    <script>
    var center = L.bounds([1.56073, 104.11475], [1.16, 103.502]).getCenter();
    var map = L.map('mapdiv').setView([center.x, center.y], 12);

    var basemap = L.tileLayer('https://maps-{s}.onemap.sg/v3/Default/{z}/{x}/{y}.png', {
        detectRetina: true,
        maxZoom: 18,
        minZoom: 11
    });

    map.setMaxBounds([[1.56073, 104.1147], [1.16, 103.502]]);

    basemap.addTo(map);

    var baseMaps = {
      "Base Layer": basemap
    };  
    var overlayMaps = {
    };
    
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } 
    }

    function showPosition(position) {						
        marker = new L.Marker([position.coords.latitude, position.coords.longitude], {bounceOnAdd: false}).addTo(map);						 
        var popup = L.popup()
        .setLatLng([position.coords.latitude, position.coords.longitude]) 
        .setContent('You are here!')
        .openOn(map);					
    }
    
    var control = L.Control.fileLayerLoad({
        // Allows you to use a customized version of L.geoJson.
        // For example if you are using the Proj4Leaflet leaflet plugin,
        // you can pass L.Proj.geoJson and load the files into the
        // L.Proj.GeoJson instead of the L.geoJson.
        layer: L.geoJson,
        // See http://leafletjs.com/reference.html#geojson-options
        layerOptions: {style: {color:'red'}},
        // Add to map after loading (default: true) ?
        addToMap: true,
        // File size limit in kb (default: 1024) ?
        fileSizeLimit: 1024,
        // Restrict accepted file formats (default: .geojson, .json, .kml, and .gpx) ?
        formats: [
            '.geojson',
            '.kml'
        ]
    }).addTo(map);

    control.loader.on('data:loaded', function (event) {
        // event.layer gives you access to the layers you just uploaded!

        // Add to map layer switcher
        layerswitcher.addOverlay(event.layer, event.filename);
    }); 
    control.loader.on('data:error', function (error) {  
        // Do something usefull with the error!
        console.error(error);
    });      
    var layerswitcher = L.control.layers(baseMaps,overlayMaps).addTo(map);
</script>
</html>
